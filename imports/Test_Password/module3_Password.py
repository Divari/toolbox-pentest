import string
import csv
import os

def evaluate_password_difficulty(mdp):
    longueur = len(mdp)
    force = 0
    
    if any(c.islower() for c in mdp):
        force += 1
    if any(c.isupper() for c in mdp):
        force += 1
    if any(c.isdigit() for c in mdp):
        force += 1
    if any(c in string.punctuation for c in mdp):
        force += 1
    
    MdpCommun = False
    base_dir = os.path.dirname(os.path.abspath(__file__))
    CsvMdp = os.path.join(base_dir, 'passwords.csv')
    with open(CsvMdp, 'r') as f:
        mots = f.read().splitlines()
        if mdp.lower() in mots:
            MdpCommun = True

    score = longueur + force
    
    if MdpCommun:
        return "Très faible - Mot de passe commun"
    elif score < 6:
        return "Très faible"
    elif score < 10:
        return "Faible"
    elif score < 15:
        return "Moyenne"
    elif score < 20:
        return "Bonne"
    else:
        return "Très bonne"

def evaluate_csv_difficulty(logins):
    difficultes = []
    with open(logins, newline='') as csvfile:
        lecteur_csv = csv.reader(csvfile)
        for ligne in lecteur_csv:
            if len(ligne) == 2:
                login, motdepasse = ligne
                difficulte = evaluate_password_difficulty(motdepasse)
                difficultes.append((login, motdepasse, difficulte))
            else:
                print("La ligne ne contient pas deux éléments.")
    return difficultes

def add_line_csv_password(fichiercsv, ligne):

    with open(fichiercsv, 'a', newline='') as csvfile:
        writer = csv.writer(csvfile)
        writer.writerow(ligne)