import paramiko

def get_fqdn(host, username, password):

    ssh = paramiko.SSHClient()
    ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())

    try:

        ssh.connect(hostname=host, username=username, password=password)
        print("Connexion réussie avec {} / {}".format(username, password))


        stdin, stdout, stderr = ssh.exec_command('hostname --fqdn')
        fqdn = stdout.read().decode().strip()

        print("FQDN de la machine distante:", fqdn)
        return ssh, fqdn  
    except paramiko.AuthenticationException:
        print("Échec de connexion avec {} / {}".format(username, password))
    except Exception as e:
        print("Erreur lors de la tentative de connexion:", str(e))
    
    print("La tentative de connexion a échoué.")
    return None, None


def ssh_scan_installed_applications(host, username, password):
    try:
        
        ssh = paramiko.SSHClient()
        ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
        
        ssh.connect(hostname=host, username=username, password=password)

        command = "dpkg -l"
        
        stdin, stdout, stderr = ssh.exec_command(command)
        
        output = stdout.read().decode()
        
        print("Applications installées sur la machine distante:")
        print(output)

        ssh.close()
    except Exception as e:
        print("Erreur lors de la connexion ou de l'exécution de la commande:", str(e))

